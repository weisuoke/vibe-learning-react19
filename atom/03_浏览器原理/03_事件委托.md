# äº‹ä»¶å§”æ‰˜

## ä¸€ã€ã€30å­—æ ¸å¿ƒã€‘

**äº‹ä»¶å§”æ‰˜æ˜¯åˆ©ç”¨äº‹ä»¶å†’æ³¡æœºåˆ¶ï¼Œå°†äº‹ä»¶ç›‘å¬å™¨ç»‘å®šåˆ°çˆ¶å…ƒç´ ä¸Šï¼Œé€šè¿‡ event.target åˆ¤æ–­å®é™…è§¦å‘å…ƒç´ ï¼Œæ˜¯ React åˆæˆäº‹ä»¶ç³»ç»Ÿçš„æ ¸å¿ƒåŸºç¡€ã€‚**

---

## äºŒã€ã€ç¬¬ä¸€æ€§åŸç†ã€‘

### ä»€ä¹ˆæ˜¯ç¬¬ä¸€æ€§åŸç†ï¼Ÿ

**ç¬¬ä¸€æ€§åŸç†**ï¼šå›åˆ°äº‹ç‰©æœ€åŸºæœ¬çš„çœŸç†ï¼Œä»æºå¤´æ€è€ƒé—®é¢˜

### äº‹ä»¶å§”æ‰˜çš„ç¬¬ä¸€æ€§åŸç† ğŸ¯

#### 1. æœ€åŸºç¡€çš„å®šä¹‰

**äº‹ä»¶å§”æ‰˜ = äº‹ä»¶å†’æ³¡ + çˆ¶å…ƒç´ ç›‘å¬ + äº‹ä»¶ç›®æ ‡åˆ¤æ–­**

ä»…æ­¤è€Œå·²ï¼æ²¡æœ‰æ›´åŸºç¡€çš„äº†ã€‚

å½“ä¸€ä¸ªå…ƒç´ è§¦å‘äº‹ä»¶æ—¶ï¼Œäº‹ä»¶ä¼šæ²¿ç€ DOM æ ‘å‘ä¸Šå†’æ³¡ã€‚å¦‚æœåœ¨çˆ¶å…ƒç´ ä¸Šè®¾ç½®ç›‘å¬å™¨ï¼Œå°±èƒ½æ•è·åˆ°å­å…ƒç´ çš„äº‹ä»¶ï¼Œé€šè¿‡ `event.target` åˆ¤æ–­æ˜¯å“ªä¸ªå­å…ƒç´ è§¦å‘çš„ã€‚

```javascript
// ä¸ç”¨äº‹ä»¶å§”æ‰˜ï¼šæ¯ä¸ªæŒ‰é’®éƒ½ç»‘å®šäº‹ä»¶
button1.addEventListener('click', handleClick);
button2.addEventListener('click', handleClick);
button3.addEventListener('click', handleClick);

// ç”¨äº‹ä»¶å§”æ‰˜ï¼šåªåœ¨çˆ¶å…ƒç´ ç»‘å®šä¸€æ¬¡
parent.addEventListener('click', (event) => {
  if (event.target.tagName === 'BUTTON') {
    handleClick(event);
  }
});
```

#### 2. ä¸ºä»€ä¹ˆéœ€è¦äº‹ä»¶å§”æ‰˜ï¼Ÿ

**æ ¸å¿ƒé—®é¢˜ï¼šå¦‚ä½•é«˜æ•ˆç®¡ç†å¤§é‡å…ƒç´ çš„äº‹ä»¶ç›‘å¬ï¼Ÿ**

ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜ï¼š
- âŒ **å†…å­˜å ç”¨é«˜**ï¼š1000 ä¸ªå…ƒç´  = 1000 ä¸ªäº‹ä»¶ç›‘å¬å™¨
- âŒ **åŠ¨æ€å…ƒç´ éº»çƒ¦**ï¼šæ–°æ·»åŠ çš„å…ƒç´ éœ€è¦é‡æ–°ç»‘å®šäº‹ä»¶
- âŒ **æ€§èƒ½å·®**ï¼šå¤§é‡ç›‘å¬å™¨å½±å“é¡µé¢æ€§èƒ½

äº‹ä»¶å§”æ‰˜çš„è§£å†³æ–¹æ¡ˆï¼š
- âœ… **å†…å­˜å ç”¨ä½**ï¼š1000 ä¸ªå…ƒç´  = 1 ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼ˆåœ¨çˆ¶å…ƒç´ ä¸Šï¼‰
- âœ… **è‡ªåŠ¨æ”¯æŒåŠ¨æ€å…ƒç´ **ï¼šæ–°æ·»åŠ çš„å­å…ƒç´ è‡ªåŠ¨ç”Ÿæ•ˆ
- âœ… **æ€§èƒ½å¥½**ï¼šå‡å°‘ç›‘å¬å™¨æ•°é‡ï¼Œæå‡æ€§èƒ½

#### 3. äº‹ä»¶å§”æ‰˜çš„ä¸‰å±‚ä»·å€¼

##### ä»·å€¼1ï¼šå‡å°‘å†…å­˜å ç”¨ ğŸ’¾

é€šè¿‡åœ¨çˆ¶å…ƒç´ ä¸Šç»‘å®šä¸€ä¸ªç›‘å¬å™¨ï¼Œæ›¿ä»£åœ¨æ¯ä¸ªå­å…ƒç´ ä¸Šç»‘å®šï¼Œå¤§å¹…é™ä½å†…å­˜å ç”¨ã€‚

```javascript
// âŒ ä¸ç”¨å§”æ‰˜ï¼š1000 ä¸ªç›‘å¬å™¨
const buttons = document.querySelectorAll('.button');
buttons.forEach(button => {
  button.addEventListener('click', handleClick);
});
// å†…å­˜å ç”¨ï¼š1000 ä¸ªç›‘å¬å™¨

// âœ… ç”¨å§”æ‰˜ï¼š1 ä¸ªç›‘å¬å™¨
const container = document.querySelector('.container');
container.addEventListener('click', (event) => {
  if (event.target.classList.contains('button')) {
    handleClick(event);
  }
});
// å†…å­˜å ç”¨ï¼š1 ä¸ªç›‘å¬å™¨
```

##### ä»·å€¼2ï¼šåŠ¨æ€å…ƒç´ è‡ªåŠ¨ç”Ÿæ•ˆ ğŸ”„

æ–°æ·»åŠ çš„å…ƒç´ æ— éœ€é‡æ–°ç»‘å®šäº‹ä»¶ï¼Œäº‹ä»¶å§”æ‰˜è‡ªåŠ¨ç”Ÿæ•ˆã€‚

```javascript
const list = document.querySelector('#list');

// äº‹ä»¶å§”æ‰˜
list.addEventListener('click', (event) => {
  if (event.target.tagName === 'LI') {
    console.log('ç‚¹å‡»äº†:', event.target.textContent);
  }
});

// åŠ¨æ€æ·»åŠ å…ƒç´ 
function addItem(text) {
  const li = document.createElement('li');
  li.textContent = text;
  list.appendChild(li);
  // æ— éœ€ç»‘å®šäº‹ä»¶ï¼Œäº‹ä»¶å§”æ‰˜è‡ªåŠ¨ç”Ÿæ•ˆï¼
}

addItem('æ–°é¡¹ç›®1');
addItem('æ–°é¡¹ç›®2');
// ç‚¹å‡»æ–°é¡¹ç›®ï¼Œäº‹ä»¶ä»ç„¶æœ‰æ•ˆ
```

##### ä»·å€¼3ï¼šReact åˆæˆäº‹ä»¶ç³»ç»Ÿçš„åŸºç¡€ âš›ï¸

React çš„åˆæˆäº‹ä»¶ç³»ç»Ÿå°±æ˜¯åŸºäºäº‹ä»¶å§”æ‰˜å®ç°çš„ï¼Œæ‰€æœ‰äº‹ä»¶éƒ½å§”æ‰˜åˆ°æ ¹å®¹å™¨ã€‚

```javascript
// React ç»„ä»¶
function TodoList() {
  const handleClick = (id) => {
    console.log('åˆ é™¤é¡¹ç›®:', id);
  };

  return (
    <ul>
      {todos.map(todo => (
        <li key={todo.id} onClick={() => handleClick(todo.id)}>
          {todo.text}
        </li>
      ))}
    </ul>
  );
}

// React å®é™…åšçš„ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š
// 1. åœ¨æ ¹å®¹å™¨ï¼ˆ#rootï¼‰ä¸Šç»‘å®šä¸€ä¸ª click ç›‘å¬å™¨
// 2. ç‚¹å‡»ä»»ä½• li æ—¶ï¼Œäº‹ä»¶å†’æ³¡åˆ°æ ¹å®¹å™¨
// 3. React æ‰¾åˆ°å¯¹åº”çš„ Fiber èŠ‚ç‚¹
// 4. æ‰§è¡Œ onClick å›è°ƒ
```

#### 4. ä»ç¬¬ä¸€æ€§åŸç†æ¨å¯¼ React å®ç°

**æ¨ç†é“¾ï¼š**
```
1. React ç»„ä»¶å¯èƒ½æœ‰æˆåƒä¸Šä¸‡ä¸ª DOM å…ƒç´ 
   â†“
2. å¦‚æœæ¯ä¸ªå…ƒç´ éƒ½ç»‘å®šçœŸå®çš„ DOM äº‹ä»¶ï¼Œå†…å­˜å ç”¨å·¨å¤§
   â†“
3. åˆ©ç”¨äº‹ä»¶å†’æ³¡æœºåˆ¶ï¼Œå¯ä»¥åœ¨æ ¹å…ƒç´ ç»Ÿä¸€ç›‘å¬
   â†“
4. é€šè¿‡ event.target æ‰¾åˆ°è§¦å‘å…ƒç´ 
   â†“
5. å†é€šè¿‡å†…éƒ¨æ˜ å°„æ‰¾åˆ°å¯¹åº”çš„ Fiber èŠ‚ç‚¹å’Œå›è°ƒå‡½æ•°
   â†“
6. React å®ç°åˆæˆäº‹ä»¶ç³»ç»Ÿï¼ˆSyntheticEventï¼‰
   â†“
7. React 17+ å°†äº‹ä»¶å§”æ‰˜ä» document æ”¹ä¸ºæ ¹å®¹å™¨
```

#### 5. ä¸€å¥è¯æ€»ç»“ç¬¬ä¸€æ€§åŸç†

**äº‹ä»¶å§”æ‰˜æ˜¯åˆ©ç”¨äº‹ä»¶å†’æ³¡æœºåˆ¶åœ¨çˆ¶å…ƒç´ ç»Ÿä¸€ç›‘å¬å­å…ƒç´ äº‹ä»¶çš„æŠ€æœ¯ï¼Œé€šè¿‡ä¸€ä¸ªç›‘å¬å™¨æ›¿ä»£å¤šä¸ªç›‘å¬å™¨ï¼Œé™ä½å†…å­˜å ç”¨ï¼Œæ”¯æŒåŠ¨æ€å…ƒç´ ï¼Œæ˜¯ React åˆæˆäº‹ä»¶ç³»ç»Ÿçš„æ ¸å¿ƒå®ç°ã€‚**

---

## ä¸‰ã€ã€3ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‘

### æ ¸å¿ƒæ¦‚å¿µ1ï¼šäº‹ä»¶å†’æ³¡ï¼ˆEvent Bubblingï¼‰ğŸ“ˆ

**äº‹ä»¶è§¦å‘åï¼Œä¼šä»ç›®æ ‡å…ƒç´ æ²¿ç€ DOM æ ‘å‘ä¸Šå†’æ³¡ï¼Œç›´åˆ° document å¯¹è±¡ã€‚**

```javascript
<div id="outer">
  <div id="middle">
    <div id="inner">ç‚¹å‡»æˆ‘</div>
  </div>
</div>

<script>
document.querySelector('#inner').addEventListener('click', () => {
  console.log('1. inner å…ƒç´ ');
});

document.querySelector('#middle').addEventListener('click', () => {
  console.log('2. middle å…ƒç´ ');
});

document.querySelector('#outer').addEventListener('click', () => {
  console.log('3. outer å…ƒç´ ');
});

document.addEventListener('click', () => {
  console.log('4. document');
});

// ç‚¹å‡» inner å…ƒç´ ï¼Œè¾“å‡ºé¡ºåºï¼š
// 1. inner å…ƒç´ 
// 2. middle å…ƒç´ 
// 3. outer å…ƒç´ 
// 4. document
</script>
```

**è¯¦ç»†è§£é‡Šï¼š**

äº‹ä»¶ä¼ æ’­çš„ä¸‰ä¸ªé˜¶æ®µï¼š
1. **æ•è·é˜¶æ®µï¼ˆCapturingï¼‰**ï¼šä» document å‘ä¸‹åˆ°ç›®æ ‡å…ƒç´ 
2. **ç›®æ ‡é˜¶æ®µï¼ˆTargetï¼‰**ï¼šåˆ°è¾¾ç›®æ ‡å…ƒç´ 
3. **å†’æ³¡é˜¶æ®µï¼ˆBubblingï¼‰**ï¼šä»ç›®æ ‡å…ƒç´ å‘ä¸Šåˆ° document

```
æ•è·é˜¶æ®µï¼šdocument â†’ html â†’ body â†’ outer â†’ middle â†’ inner
ç›®æ ‡é˜¶æ®µï¼šinnerï¼ˆevent.targetï¼‰
å†’æ³¡é˜¶æ®µï¼šinner â†’ middle â†’ outer â†’ body â†’ html â†’ document
```

é»˜è®¤æƒ…å†µä¸‹ï¼ŒaddEventListener åœ¨**å†’æ³¡é˜¶æ®µ**ç›‘å¬äº‹ä»¶ã€‚å¯ä»¥é€šè¿‡ç¬¬ä¸‰ä¸ªå‚æ•°æ”¹ä¸ºæ•è·é˜¶æ®µï¼š

```javascript
element.addEventListener('click', handler, true); // æ•è·é˜¶æ®µ
element.addEventListener('click', handler, false); // å†’æ³¡é˜¶æ®µï¼ˆé»˜è®¤ï¼‰
```

**åœ¨ React æºç ä¸­çš„åº”ç”¨ï¼š**

React åœ¨æ ¹å®¹å™¨ä¸ŠåŒæ—¶ç›‘å¬æ•è·å’Œå†’æ³¡é˜¶æ®µçš„äº‹ä»¶ï¼Œå®ç°å®Œæ•´çš„äº‹ä»¶å¤„ç†ã€‚

```javascript
// React 17+ åœ¨æ ¹å®¹å™¨ä¸Šæ³¨å†Œäº‹ä»¶
const root = document.querySelector('#root');

// æ•è·é˜¶æ®µ
root.addEventListener('click', handleClickCapture, true);

// å†’æ³¡é˜¶æ®µ
root.addEventListener('click', handleClickBubble, false);
```

---

### æ ¸å¿ƒæ¦‚å¿µ2ï¼ševent.target vs event.currentTarget ğŸ¯

**event.target æ˜¯å®é™…è§¦å‘äº‹ä»¶çš„å…ƒç´ ï¼Œevent.currentTarget æ˜¯ç»‘å®šç›‘å¬å™¨çš„å…ƒç´ ã€‚**

```javascript
<div id="parent">
  <button id="child">ç‚¹å‡»æˆ‘</button>
</div>

<script>
const parent = document.querySelector('#parent');

parent.addEventListener('click', (event) => {
  console.log('event.target:', event.target.id);         // å®é™…ç‚¹å‡»çš„å…ƒç´ 
  console.log('event.currentTarget:', event.currentTarget.id); // ç»‘å®šç›‘å¬å™¨çš„å…ƒç´ 
});

// ç‚¹å‡»æŒ‰é’®ï¼Œè¾“å‡ºï¼š
// event.target: childï¼ˆå®é™…ç‚¹å‡»çš„æŒ‰é’®ï¼‰
// event.currentTarget: parentï¼ˆç»‘å®šç›‘å¬å™¨çš„çˆ¶å…ƒç´ ï¼‰
</script>
```

**è¯¦ç»†è§£é‡Šï¼š**

äº‹ä»¶å§”æ‰˜çš„æ ¸å¿ƒå°±æ˜¯åˆ©ç”¨ `event.target` åˆ¤æ–­å®é™…è§¦å‘äº‹ä»¶çš„å…ƒç´ ï¼š

```javascript
const list = document.querySelector('#list');

list.addEventListener('click', (event) => {
  // event.currentTarget æ°¸è¿œæ˜¯ list
  // event.target æ˜¯å®é™…ç‚¹å‡»çš„å…ƒç´ ï¼ˆå¯èƒ½æ˜¯ liã€buttonã€span ç­‰ï¼‰

  if (event.target.tagName === 'BUTTON') {
    console.log('ç‚¹å‡»äº†æŒ‰é’®:', event.target.textContent);
  } else if (event.target.tagName === 'LI') {
    console.log('ç‚¹å‡»äº†åˆ—è¡¨é¡¹:', event.target.textContent);
  }
});
```

**å¸¸è§é™·é˜±**ï¼š

å¦‚æœç‚¹å‡»çš„æ˜¯æŒ‰é’®å†…çš„ `<span>`ï¼Œ`event.target` æ˜¯ span è€Œä¸æ˜¯ buttonï¼š

```javascript
<button class="delete-btn">
  <span>åˆ é™¤</span>
</button>

list.addEventListener('click', (event) => {
  // âŒ é”™è¯¯ï¼šç‚¹å‡» span æ—¶ï¼Œevent.target æ˜¯ span
  if (event.target.classList.contains('delete-btn')) {
    console.log('åˆ é™¤');
  }

  // âœ… æ­£ç¡®ï¼šä½¿ç”¨ closest å‘ä¸ŠæŸ¥æ‰¾
  const button = event.target.closest('.delete-btn');
  if (button) {
    console.log('åˆ é™¤');
  }
});
```

**åœ¨ React æºç ä¸­çš„åº”ç”¨ï¼š**

React é€šè¿‡ `event.target` æ‰¾åˆ°è§¦å‘äº‹ä»¶çš„ DOM èŠ‚ç‚¹ï¼Œç„¶åé€šè¿‡å†…éƒ¨æ˜ å°„æ‰¾åˆ°å¯¹åº”çš„ Fiber èŠ‚ç‚¹ã€‚

```javascript
// React åˆæˆäº‹ä»¶å¤„ç†ï¼ˆç®€åŒ–ç‰ˆï¼‰
function dispatchEvent(nativeEvent) {
  const targetDOM = nativeEvent.target;

  // é€šè¿‡ DOM èŠ‚ç‚¹æ‰¾åˆ°å¯¹åº”çš„ Fiber èŠ‚ç‚¹
  const targetFiber = getClosestInstanceFromNode(targetDOM);

  // ä» Fiber èŠ‚ç‚¹è·å–äº‹ä»¶å›è°ƒ
  const listener = targetFiber.memoizedProps.onClick;

  // æ‰§è¡Œå›è°ƒ
  if (listener) {
    listener(syntheticEvent);
  }
}
```

---

### æ ¸å¿ƒæ¦‚å¿µ3ï¼šstopPropagation é˜»æ­¢å†’æ³¡ ğŸ›‘

**event.stopPropagation() é˜»æ­¢äº‹ä»¶ç»§ç»­å†’æ³¡ï¼Œä½†ä¸å½±å“å½“å‰å…ƒç´ çš„å…¶ä»–ç›‘å¬å™¨ã€‚**

```javascript
<div id="parent">
  <div id="child">
    <button id="button">ç‚¹å‡»æˆ‘</button>
  </div>
</div>

<script>
document.querySelector('#button').addEventListener('click', (event) => {
  console.log('1. æŒ‰é’®ç‚¹å‡»');
  event.stopPropagation(); // é˜»æ­¢å†’æ³¡
});

document.querySelector('#child').addEventListener('click', () => {
  console.log('2. child ç‚¹å‡»'); // ä¸ä¼šæ‰§è¡Œ
});

document.querySelector('#parent').addEventListener('click', () => {
  console.log('3. parent ç‚¹å‡»'); // ä¸ä¼šæ‰§è¡Œ
});

// ç‚¹å‡»æŒ‰é’®ï¼Œåªè¾“å‡ºï¼š
// 1. æŒ‰é’®ç‚¹å‡»
</script>
```

**è¯¦ç»†è§£é‡Šï¼š**

ç›¸å…³æ–¹æ³•ï¼š

| æ–¹æ³• | ä½œç”¨ |
|-----|------|
| `stopPropagation()` | é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œä½†å½“å‰å…ƒç´ çš„å…¶ä»–ç›‘å¬å™¨ä»æ‰§è¡Œ |
| `stopImmediatePropagation()` | é˜»æ­¢å†’æ³¡ï¼Œä¸”å½“å‰å…ƒç´ çš„å…¶ä»–ç›‘å¬å™¨ä¹Ÿä¸æ‰§è¡Œ |
| `preventDefault()` | é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼ˆå¦‚é“¾æ¥è·³è½¬ã€è¡¨å•æäº¤ï¼‰ |

```javascript
button.addEventListener('click', (event) => {
  console.log('ç›‘å¬å™¨ 1');
  event.stopPropagation(); // é˜»æ­¢å†’æ³¡
});

button.addEventListener('click', (event) => {
  console.log('ç›‘å¬å™¨ 2'); // ä»ç„¶æ‰§è¡Œ
});

// è¾“å‡º:
// ç›‘å¬å™¨ 1
// ç›‘å¬å™¨ 2
```

```javascript
button.addEventListener('click', (event) => {
  console.log('ç›‘å¬å™¨ 1');
  event.stopImmediatePropagation(); // ç«‹å³é˜»æ­¢
});

button.addEventListener('click', (event) => {
  console.log('ç›‘å¬å™¨ 2'); // ä¸æ‰§è¡Œ
});

// è¾“å‡º:
// ç›‘å¬å™¨ 1
```

**åœ¨ React æºç ä¸­çš„åº”ç”¨ï¼š**

React çš„ `event.stopPropagation()` åªé˜»æ­¢ React åˆæˆäº‹ä»¶çš„å†’æ³¡ï¼Œä¸å½±å“åŸç”Ÿäº‹ä»¶å†’æ³¡ã€‚

```javascript
function handleClick(event) {
  event.stopPropagation(); // é˜»æ­¢ React åˆæˆäº‹ä»¶å†’æ³¡

  // ä½†åŸç”Ÿäº‹ä»¶ä»ç„¶ä¼šå†’æ³¡åˆ°æ ¹å®¹å™¨
}

// React 17+ æ”¹è¿›ï¼šä½¿ç”¨ event.nativeEvent.stopPropagation()
// å¯ä»¥åŒæ—¶é˜»æ­¢åŸç”Ÿäº‹ä»¶å†’æ³¡
```

---

## å››ã€ã€æœ€å°å¯ç”¨ã€‘

æŒæ¡ä»¥ä¸‹å†…å®¹ï¼Œå°±èƒ½ç†è§£ React åˆæˆäº‹ä»¶ç³»ç»Ÿçš„æ ¸å¿ƒåŸç†ï¼š

### 4.1 åŸºç¡€ç”¨æ³•ï¼šå®ç°ç®€å•çš„äº‹ä»¶å§”æ‰˜

```javascript
const list = document.querySelector('#list');

list.addEventListener('click', (event) => {
  if (event.target.tagName === 'LI') {
    console.log('ç‚¹å‡»äº†:', event.target.textContent);
  }
});
```

### 4.2 åŠ¨æ€å…ƒç´ ï¼šè‡ªåŠ¨æ”¯æŒæ–°æ·»åŠ çš„å…ƒç´ 

```javascript
const container = document.querySelector('#container');

// äº‹ä»¶å§”æ‰˜
container.addEventListener('click', (event) => {
  if (event.target.classList.contains('delete-btn')) {
    event.target.parentElement.remove();
  }
});

// åŠ¨æ€æ·»åŠ å…ƒç´ ï¼ˆæ— éœ€é‡æ–°ç»‘å®šäº‹ä»¶ï¼‰
function addItem(text) {
  const div = document.createElement('div');
  div.innerHTML = `
    <span>${text}</span>
    <button class="delete-btn">åˆ é™¤</button>
  `;
  container.appendChild(div);
}
```

### 4.3 ä½¿ç”¨ closest å¤„ç†åµŒå¥—å…ƒç´ 

```javascript
list.addEventListener('click', (event) => {
  // å‘ä¸ŠæŸ¥æ‰¾æœ€è¿‘çš„ .list-item
  const item = event.target.closest('.list-item');

  if (item) {
    console.log('ç‚¹å‡»äº†é¡¹ç›®:', item.dataset.id);
  }
});
```

**è¿™äº›çŸ¥è¯†è¶³ä»¥ï¼š**
- ç†è§£äº‹ä»¶å†’æ³¡å’Œå§”æ‰˜çš„åŸºæœ¬åŸç†
- å®ç°é«˜æ€§èƒ½çš„äº‹ä»¶å¤„ç†
- ä¸ºç†è§£ React åˆæˆäº‹ä»¶ç³»ç»Ÿæ‰“åŸºç¡€

---

## äº”ã€ã€1ä¸ªç±»æ¯”ã€‘

### ç±»æ¯”1ï¼šäº‹ä»¶å§”æ‰˜ = å…¬å¸å‰å°ä»£æ”¶å¿«é€’ ğŸ“¦

**äº‹ä»¶å§”æ‰˜å°±åƒå…¬å¸å‰å°ç»Ÿä¸€æ¥æ”¶æ‰€æœ‰å¿«é€’ï¼Œç„¶ååˆ†å‘ç»™å„ä¸ªéƒ¨é—¨ï¼Œè€Œä¸æ˜¯å¿«é€’å‘˜æŒ¨ä¸ªé€åˆ°æ¯ä¸ªéƒ¨é—¨ã€‚**

**ä¸¾ä¾‹ï¼š**

ä¸ç”¨äº‹ä»¶å§”æ‰˜ï¼ˆå¿«é€’å‘˜é€åˆ°æ¯ä¸ªéƒ¨é—¨ï¼‰ï¼š
```
å¿«é€’å‘˜ â†’ å¸‚åœºéƒ¨ï¼ˆæ•²é—¨ã€ç­¾æ”¶ï¼‰
å¿«é€’å‘˜ â†’ æŠ€æœ¯éƒ¨ï¼ˆæ•²é—¨ã€ç­¾æ”¶ï¼‰
å¿«é€’å‘˜ â†’ äººäº‹éƒ¨ï¼ˆæ•²é—¨ã€ç­¾æ”¶ï¼‰
å¿«é€’å‘˜ â†’ è´¢åŠ¡éƒ¨ï¼ˆæ•²é—¨ã€ç­¾æ”¶ï¼‰
è€—æ—¶ï¼š4 Ã— 5åˆ†é’Ÿ = 20åˆ†é’Ÿ
```

ç”¨äº‹ä»¶å§”æ‰˜ï¼ˆå‰å°ç»Ÿä¸€æ¥æ”¶ï¼‰ï¼š
```
å¿«é€’å‘˜ â†’ å‰å°ï¼ˆä¸€æ¬¡æ€§äº¤ä»˜æ‰€æœ‰å¿«é€’ï¼‰
å‰å° â†’ æŸ¥çœ‹æ”¶ä»¶äºº â†’ åˆ†å‘åˆ°å¯¹åº”éƒ¨é—¨
è€—æ—¶ï¼š5åˆ†é’Ÿ
```

```javascript
// ä¸ç”¨å§”æ‰˜ï¼šæ¯ä¸ªéƒ¨é—¨éƒ½è¦"å¼€é—¨"ï¼ˆç»‘å®šäº‹ä»¶ï¼‰
document.querySelector('#marketing').addEventListener('click', handleClick);
document.querySelector('#tech').addEventListener('click', handleClick);
document.querySelector('#hr').addEventListener('click', handleClick);
document.querySelector('#finance').addEventListener('click', handleClick);

// ç”¨å§”æ‰˜ï¼šåªæœ‰å‰å°"å¼€é—¨"ï¼ˆçˆ¶å…ƒç´ ç»‘å®šäº‹ä»¶ï¼‰
document.querySelector('#company').addEventListener('click', (event) => {
  const department = event.target.closest('[data-dept]');
  if (department) {
    handleClick(department.dataset.dept);
  }
});
```

---

### ç±»æ¯”2ï¼šäº‹ä»¶å†’æ³¡ = å­¦ç”Ÿä¸¾æ‰‹å‘è¨€ ğŸ™‹

**äº‹ä»¶å†’æ³¡å°±åƒå­¦ç”Ÿä¸¾æ‰‹å‘è¨€ï¼Œä¿¡å·ä»å­¦ç”Ÿ â†’ å°ç»„é•¿ â†’ ç­é•¿ â†’ è€å¸ˆï¼Œä¸€å±‚å±‚å‘ä¸Šä¼ é€’ã€‚**

**ä¸¾ä¾‹ï¼š**

```
å­¦ç”Ÿï¼ˆevent.targetï¼‰ä¸¾æ‰‹
   â†“ å†’æ³¡
å°ç»„é•¿çœ‹åˆ°äº†
   â†“ å†’æ³¡
ç­é•¿çœ‹åˆ°äº†
   â†“ å†’æ³¡
è€å¸ˆçœ‹åˆ°äº†ï¼ˆåšå‡ºå“åº”ï¼‰
```

å¦‚æœå°ç»„é•¿è¯´"ä¸è¦ä¼ ä¸Šå»"ï¼ˆstopPropagationï¼‰ï¼Œç­é•¿å’Œè€å¸ˆå°±æ”¶ä¸åˆ°ä¿¡å·ã€‚

```javascript
// å­¦ç”Ÿ
student.addEventListener('click', (event) => {
  console.log('å­¦ç”Ÿä¸¾æ‰‹');
  // å¦‚æœè¿™é‡Œ event.stopPropagation()ï¼Œä¿¡å·å°±ä¸ä¼šä¼ ç»™å°ç»„é•¿
});

// å°ç»„é•¿
groupLeader.addEventListener('click', (event) => {
  console.log('å°ç»„é•¿æ”¶åˆ°');
  event.stopPropagation(); // é˜»æ­¢ä¿¡å·ä¼ ç»™ç­é•¿
});

// ç­é•¿
classMonitor.addEventListener('click', (event) => {
  console.log('ç­é•¿æ”¶åˆ°'); // ä¸ä¼šæ‰§è¡Œ
});

// è€å¸ˆ
teacher.addEventListener('click', (event) => {
  console.log('è€å¸ˆæ”¶åˆ°'); // ä¸ä¼šæ‰§è¡Œ
});
```

---

### ç±»æ¯”3ï¼šç­é•¿ç»Ÿä¸€æ”¶ä½œä¸š ğŸ“š

**äº‹ä»¶å§”æ‰˜å°±åƒè€å¸ˆè®©ç­é•¿ç»Ÿä¸€æ”¶ä½œä¸šï¼Œè€Œä¸æ˜¯è€å¸ˆé€ä¸ªæ‰¾æ¯ä¸ªå­¦ç”Ÿæ”¶ã€‚**

**ä¸¾ä¾‹ï¼š**

ä¸ç”¨äº‹ä»¶å§”æ‰˜ï¼ˆè€å¸ˆé€ä¸ªæ”¶ï¼‰ï¼š
```
è€å¸ˆ â†’ æ‰¾å­¦ç”Ÿ1 â†’ æ”¶ä½œä¸š
è€å¸ˆ â†’ æ‰¾å­¦ç”Ÿ2 â†’ æ”¶ä½œä¸š
è€å¸ˆ â†’ æ‰¾å­¦ç”Ÿ3 â†’ æ”¶ä½œä¸š
...ï¼ˆ30ä¸ªå­¦ç”Ÿï¼‰
```

ç”¨äº‹ä»¶å§”æ‰˜ï¼ˆç­é•¿ç»Ÿä¸€æ”¶ï¼‰ï¼š
```
è€å¸ˆ â†’ å‘Šè¯‰ç­é•¿"æ”¶ä½œä¸š"
ç­é•¿ â†’ å¹¿æ’­é€šçŸ¥
å­¦ç”Ÿä»¬ â†’ äº¤ç»™ç­é•¿
ç­é•¿ â†’ ç»Ÿä¸€äº¤ç»™è€å¸ˆ
```

```javascript
// âŒ ä¸ç”¨å§”æ‰˜ï¼šè€å¸ˆé€ä¸ªæ”¶ï¼ˆæ¯ä¸ªå­¦ç”Ÿç»‘å®šäº‹ä»¶ï¼‰
students.forEach(student => {
  student.addEventListener('submit', (event) => {
    teacher.receive(event.target.homework);
  });
});

// âœ… ç”¨å§”æ‰˜ï¼šç­é•¿ç»Ÿä¸€æ”¶ï¼ˆåªåœ¨ç­çº§å®¹å™¨ç»‘å®šäº‹ä»¶ï¼‰
classroom.addEventListener('submit', (event) => {
  if (event.target.classList.contains('student')) {
    teacher.receive(event.target.homework);
  }
});
```

---

### ç±»æ¯”4ï¼šReact åˆæˆäº‹ä»¶ = ç‰©ä¸šç®¡ç†ä¸­å¿ƒ ğŸ¢

**React çš„åˆæˆäº‹ä»¶ç³»ç»Ÿå°±åƒå°åŒºç‰©ä¸šç®¡ç†ä¸­å¿ƒï¼Œç»Ÿä¸€æ¥æ”¶å’Œå¤„ç†å„ä¸ªæ¥¼æ ‹çš„æŠ¥ä¿®è¯·æ±‚ã€‚**

**ä¸¾ä¾‹ï¼š**

ä¼ ç»Ÿæ–¹å¼ï¼ˆæ¯ä¸ªæ¥¼æ ‹æœ‰ç»´ä¿®å‘˜ï¼‰ï¼š
```
1å·æ¥¼ â†’ ç»´ä¿®å‘˜A
2å·æ¥¼ â†’ ç»´ä¿®å‘˜B
3å·æ¥¼ â†’ ç»´ä¿®å‘˜C
...
100å·æ¥¼ â†’ ç»´ä¿®å‘˜XX
æˆæœ¬é«˜ï¼
```

React æ–¹å¼ï¼ˆç‰©ä¸šç®¡ç†ä¸­å¿ƒï¼‰ï¼š
```
æ‰€æœ‰æ¥¼æ ‹ â†’ æŠ¥ä¿®åˆ°ç‰©ä¸šä¸­å¿ƒ
ç‰©ä¸šä¸­å¿ƒ â†’ æŸ¥çœ‹æŠ¥ä¿®å•ï¼ˆevent.targetï¼‰
         â†’ æ´¾é£å¯¹åº”çš„ç»´ä¿®å‘˜
         â†’ ç»Ÿä¸€ç®¡ç†å’Œä¼˜åŒ–
æˆæœ¬ä½ï¼æ•ˆç‡é«˜ï¼
```

```javascript
// React 17+ çš„äº‹ä»¶å§”æ‰˜
// æ‰€æœ‰äº‹ä»¶éƒ½å§”æ‰˜åˆ°æ ¹å®¹å™¨ï¼ˆç‰©ä¸šä¸­å¿ƒï¼‰

const root = ReactDOM.createRoot(document.getElementById('root'));

root.render(
  <div>
    <Building1 onClick={handleClick1} />
    <Building2 onClick={handleClick2} />
    <Building3 onClick={handleClick3} />
  </div>
);

// React å®é™…åšçš„ï¼š
// 1. åœ¨ #root ä¸Šç»‘å®šä¸€ä¸ª click ç›‘å¬å™¨ï¼ˆç‰©ä¸šä¸­å¿ƒï¼‰
// 2. ç‚¹å‡»ä»»ä½•æ¥¼æ ‹æ—¶ï¼Œäº‹ä»¶å†’æ³¡åˆ° #rootï¼ˆæŠ¥ä¿®åˆ°ä¸­å¿ƒï¼‰
// 3. React æŸ¥çœ‹ event.target æ‰¾åˆ°å¯¹åº”çš„ Fiber èŠ‚ç‚¹ï¼ˆæŸ¥çœ‹æŠ¥ä¿®å•ï¼‰
// 4. æ‰§è¡Œå¯¹åº”çš„ onClick å›è°ƒï¼ˆæ´¾é£ç»´ä¿®å‘˜ï¼‰
```

---

### ç±»æ¯”æ€»ç»“è¡¨

| React/æµè§ˆå™¨æ¦‚å¿µ | ç”Ÿæ´»åœºæ™¯ | å…³é”®ç›¸ä¼¼ç‚¹ |
|-----------------|---------|----------|
| äº‹ä»¶å§”æ‰˜ | å‰å°ä»£æ”¶å¿«é€’ | ç»Ÿä¸€æ¥æ”¶ï¼Œå†åˆ†å‘ |
| äº‹ä»¶å†’æ³¡ | å­¦ç”Ÿä¸¾æ‰‹å‘è¨€ | ä¿¡å·é€å±‚å‘ä¸Šä¼ é€’ |
| stopPropagation | å°ç»„é•¿æ‹¦æˆªä¿¡æ¯ | é˜»æ­¢ä¿¡å·ç»§ç»­å‘ä¸Š |
| event.target | å¿«é€’ä¸Šçš„æ”¶ä»¶äºº | å®é™…çš„ç›®æ ‡å¯¹è±¡ |
| React åˆæˆäº‹ä»¶ | ç‰©ä¸šç®¡ç†ä¸­å¿ƒ | ç»Ÿä¸€ç®¡ç†ï¼Œä¼˜åŒ–åˆ†å‘ |

---

## å…­ã€ã€åç›´è§‰ç‚¹ã€‘

### è¯¯åŒº1ï¼šReact äº‹ä»¶å§”æ‰˜åˆ° document âŒ

**ä¸ºä»€ä¹ˆé”™ï¼Ÿ**
- React 16 åŠä¹‹å‰ï¼šäº‹ä»¶å§”æ‰˜åˆ° `document`
- React 17+ï¼šäº‹ä»¶å§”æ‰˜åˆ°**æ ¹å®¹å™¨**ï¼ˆå¦‚ `#root`ï¼‰

**ä¸ºä»€ä¹ˆäººä»¬å®¹æ˜“è¿™æ ·é”™ï¼Ÿ**

å¾ˆå¤šæ•™ç¨‹å’Œæ–‡ç« æ˜¯åŸºäº React 16 å†™çš„ï¼Œé‚£æ—¶ç¡®å®å§”æ‰˜åˆ° `document`ã€‚ä½† React 17 æ”¹å˜äº†è¿™ä¸ªè¡Œä¸ºï¼Œå¯¼è‡´è¿‡æ—¶çš„çŸ¥è¯†è¯¯å¯¼äº†äººä»¬ã€‚

**æ­£ç¡®ç†è§£ï¼š**

```javascript
// React 16 åŠä¹‹å‰
document.addEventListener('click', reactEventHandler);

// React 17+
const root = document.getElementById('root');
root.addEventListener('click', reactEventHandler);
```

**ä¸ºä»€ä¹ˆ React 17 è¦æ”¹ï¼Ÿ**

1. **æ”¯æŒå¤šä¸ª React åº”ç”¨**ï¼šåœ¨åŒä¸€é¡µé¢è¿è¡Œå¤šä¸ª React åº”ç”¨æ—¶ï¼Œå¦‚æœéƒ½å§”æ‰˜åˆ° `document`ï¼Œäº‹ä»¶ä¼šç›¸äº’å¹²æ‰°
2. **æ”¯æŒå¾®å‰ç«¯**ï¼šä¸åŒå¾®å‰ç«¯åº”ç”¨çš„äº‹ä»¶ä¸ä¼šäº’ç›¸å½±å“
3. **æ›´å¥½çš„äº‹ä»¶éš”ç¦»**ï¼š`event.stopPropagation()` å¯ä»¥çœŸæ­£é˜»æ­¢äº‹ä»¶ä¼ æ’­åˆ°å…¶ä»– React åº”ç”¨

```javascript
// åŒä¸€é¡µé¢ä¸¤ä¸ª React åº”ç”¨
<div id="app1"></div>
<div id="app2"></div>

// React 16ï¼šéƒ½å§”æ‰˜åˆ° documentï¼Œä¼šäº’ç›¸å¹²æ‰°
// React 17+ï¼šåˆ†åˆ«å§”æ‰˜åˆ° #app1 å’Œ #app2ï¼Œäº’ä¸å¹²æ‰°
```

---

### è¯¯åŒº2ï¼šæ‰€æœ‰äº‹ä»¶éƒ½é€šè¿‡å§”æ‰˜å¤„ç† âŒ

**ä¸ºä»€ä¹ˆé”™ï¼Ÿ**
- å¹¶éæ‰€æœ‰äº‹ä»¶éƒ½é€‚åˆå§”æ‰˜
- æœ‰äº›äº‹ä»¶**ä¸å†’æ³¡**ï¼ˆå¦‚ `focus`ã€`blur`ã€`scroll`ã€`load`ï¼‰
- React å¯¹è¿™äº›äº‹ä»¶é‡‡ç”¨**ç›´æ¥ç»‘å®š**ç­–ç•¥

**ä¸ºä»€ä¹ˆäººä»¬å®¹æ˜“è¿™æ ·é”™ï¼Ÿ**

å› ä¸º React å®˜æ–¹æ–‡æ¡£å¼ºè°ƒ"åˆæˆäº‹ä»¶ç³»ç»Ÿ"ï¼Œç»™äººä¸€ç§"æ‰€æœ‰äº‹ä»¶éƒ½ä¸€æ ·å¤„ç†"çš„å°è±¡ã€‚å®é™…ä¸Šï¼ŒReact å¯¹ä¸åŒäº‹ä»¶æœ‰ä¸åŒçš„å¤„ç†ç­–ç•¥ã€‚

**æ­£ç¡®ç†è§£ï¼š**

```javascript
// å†’æ³¡äº‹ä»¶ï¼ˆå§”æ‰˜å¤„ç†ï¼‰
<button onClick={handleClick}>ç‚¹å‡»</button>
// React åœ¨æ ¹å®¹å™¨ç›‘å¬ click

// ä¸å†’æ³¡äº‹ä»¶ï¼ˆç›´æ¥ç»‘å®šï¼‰
<input onFocus={handleFocus} />
// React ç›´æ¥åœ¨ input å…ƒç´ ä¸Šç»‘å®š focus äº‹ä»¶
```

**React æºç ä¸­çš„å¤„ç†**ï¼š

```javascript
// React æºç ï¼ˆç®€åŒ–ç‰ˆï¼‰
const nonBubblingEvents = ['focus', 'blur', 'scroll', 'load', 'error'];

function registerEvent(domElement, eventType, handler) {
  if (nonBubblingEvents.includes(eventType)) {
    // ä¸å†’æ³¡äº‹ä»¶ï¼šç›´æ¥ç»‘å®šåˆ°å…ƒç´ 
    domElement.addEventListener(eventType, handler);
  } else {
    // å†’æ³¡äº‹ä»¶ï¼šå§”æ‰˜åˆ°æ ¹å®¹å™¨
    rootContainer.addEventListener(eventType, dispatchEvent);
  }
}
```

**éªŒè¯æ–¹å¼**ï¼š

```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œ
const input = document.querySelector('input');
const root = document.querySelector('#root');

console.log('input ä¸Šçš„äº‹ä»¶:', getEventListeners(input));
// è¾“å‡ºï¼šfocus, blur ç­‰ä¸å†’æ³¡äº‹ä»¶

console.log('root ä¸Šçš„äº‹ä»¶:', getEventListeners(root));
// è¾“å‡ºï¼šclick, change ç­‰å†’æ³¡äº‹ä»¶
```

---

### è¯¯åŒº3ï¼šReact äº‹ä»¶å°±æ˜¯åŸç”Ÿäº‹ä»¶ âŒ

**ä¸ºä»€ä¹ˆé”™ï¼Ÿ**
- React çš„äº‹ä»¶æ˜¯**åˆæˆäº‹ä»¶ï¼ˆSyntheticEventï¼‰**ï¼Œä¸æ˜¯åŸç”Ÿäº‹ä»¶
- åˆæˆäº‹ä»¶æ˜¯å¯¹åŸç”Ÿäº‹ä»¶çš„å°è£…ï¼Œæä¾›è·¨æµè§ˆå™¨ä¸€è‡´çš„ API
- åˆæˆäº‹ä»¶æœ‰äº‹ä»¶æ± æœºåˆ¶ï¼ˆReact 16ï¼‰æˆ–è‡ªåŠ¨é‡Šæ”¾ï¼ˆReact 17+ï¼‰

**ä¸ºä»€ä¹ˆäººä»¬å®¹æ˜“è¿™æ ·é”™ï¼Ÿ**

å› ä¸º React çš„äº‹ä»¶å¤„ç†è¯­æ³•ï¼ˆ`onClick`ã€`onChange`ï¼‰çœ‹èµ·æ¥å’ŒåŸç”Ÿäº‹ä»¶å¾ˆåƒï¼ŒAPI ä¹Ÿå‡ ä¹ç›¸åŒï¼ˆ`event.target`ã€`event.preventDefault()`ï¼‰ï¼Œå®¹æ˜“æ··æ·†ã€‚

**æ­£ç¡®ç†è§£ï¼š**

```javascript
function handleClick(event) {
  console.log(event); // SyntheticBaseEventï¼Œä¸æ˜¯ MouseEvent
  console.log(event.nativeEvent); // åŸç”Ÿçš„ MouseEvent

  // åˆæˆäº‹ä»¶çš„å±æ€§
  console.log(event.target); // å’ŒåŸç”Ÿä¸€æ ·
  console.log(event.currentTarget); // å’ŒåŸç”Ÿä¸€æ ·
  console.log(event.bubbles); // å’ŒåŸç”Ÿä¸€æ ·

  // ä½†åº•å±‚å®ç°ä¸åŒ
  console.log(event.isPropagationStopped()); // React ç‰¹æœ‰
}

<button onClick={handleClick}>ç‚¹å‡»</button>
```

**åˆæˆäº‹ä»¶ vs åŸç”Ÿäº‹ä»¶**ï¼š

| ç‰¹æ€§ | åˆæˆäº‹ä»¶ | åŸç”Ÿäº‹ä»¶ |
|-----|---------|---------|
| è·¨æµè§ˆå™¨ | ç»Ÿä¸€çš„ API | å„æµè§ˆå™¨å¯èƒ½ä¸åŒ |
| æ€§èƒ½ | äº‹ä»¶å§”æ‰˜ï¼Œå†…å­˜å ç”¨ä½ | æ¯ä¸ªå…ƒç´ ç‹¬ç«‹ç»‘å®š |
| äº‹ä»¶æ±  | React 16 æœ‰ï¼ˆ17+ ç§»é™¤ï¼‰ | æ—  |
| é˜»æ­¢å†’æ³¡ | åªé˜»æ­¢ React åˆæˆäº‹ä»¶ | é˜»æ­¢åŸç”Ÿäº‹ä»¶ |

**React 16 çš„äº‹ä»¶æ± é™·é˜±**ï¼ˆReact 17+ å·²ç§»é™¤ï¼‰ï¼š

```javascript
// React 16
function handleClick(event) {
  console.log(event.type); // "click"

  setTimeout(() => {
    console.log(event.type); // nullï¼ˆäº‹ä»¶å¯¹è±¡è¢«å›æ”¶äº†ï¼ï¼‰
  }, 100);
}

// è§£å†³æ–¹æ³•ï¼ševent.persist()
function handleClick(event) {
  event.persist(); // ä¿æŒäº‹ä»¶å¯¹è±¡

  setTimeout(() => {
    console.log(event.type); // "click"
  }, 100);
}

// React 17+ï¼šä¸éœ€è¦ persistï¼Œäº‹ä»¶å¯¹è±¡ä¸ä¼šè¢«å›æ”¶
```

---

## ä¸ƒã€ã€å®æˆ˜ä»£ç ã€‘

### åŸºç¡€å®ç°ï¼ˆç®€åŒ–ç‰ˆï¼‰

```javascript
// ===== 1. åœºæ™¯1ï¼šåŸºç¡€äº‹ä»¶å§”æ‰˜ =====
console.log("=== åœºæ™¯1ï¼šåˆ—è¡¨é¡¹ç‚¹å‡» ===");

<ul id="list">
  <li data-id="1">é¡¹ç›®1</li>
  <li data-id="2">é¡¹ç›®2</li>
  <li data-id="3">é¡¹ç›®3</li>
</ul>

const list = document.querySelector('#list');

list.addEventListener('click', (event) => {
  if (event.target.tagName === 'LI') {
    const id = event.target.dataset.id;
    console.log(`ç‚¹å‡»äº†é¡¹ç›® ${id}`);
  }
});

// ç‚¹å‡»é¡¹ç›®2ï¼Œè¾“å‡ºï¼šç‚¹å‡»äº†é¡¹ç›® 2

// ===== 2. åœºæ™¯2ï¼šåŠ¨æ€æ·»åŠ å…ƒç´  =====
console.log("\n=== åœºæ™¯2ï¼šåŠ¨æ€æ·»åŠ å…ƒç´  ===");

<div id="todo-list"></div>
<button id="add-btn">æ·»åŠ å¾…åŠ</button>

const todoList = document.querySelector('#todo-list');
let todoId = 0;

// äº‹ä»¶å§”æ‰˜ï¼ˆåœ¨åŠ¨æ€æ·»åŠ å…ƒç´ ä¹‹å‰è®¾ç½®ï¼‰
todoList.addEventListener('click', (event) => {
  const deleteBtn = event.target.closest('.delete-btn');

  if (deleteBtn) {
    const todoItem = deleteBtn.closest('.todo-item');
    todoItem.remove();
    console.log('å·²åˆ é™¤å¾…åŠ');
  }
});

// åŠ¨æ€æ·»åŠ å¾…åŠ
document.querySelector('#add-btn').addEventListener('click', () => {
  todoId++;

  const todoItem = document.createElement('div');
  todoItem.className = 'todo-item';
  todoItem.innerHTML = `
    <span>å¾…åŠäº‹é¡¹ ${todoId}</span>
    <button class="delete-btn">åˆ é™¤</button>
  `;

  todoList.appendChild(todoItem);
  console.log(`æ·»åŠ äº†å¾…åŠ ${todoId}`);
});

// ç‚¹å‡»"æ·»åŠ å¾…åŠ"3æ¬¡ï¼Œç„¶åç‚¹å‡»"åˆ é™¤"æŒ‰é’®
// è¾“å‡ºï¼š
// æ·»åŠ äº†å¾…åŠ 1
// æ·»åŠ äº†å¾…åŠ 2
// æ·»åŠ äº†å¾…åŠ 3
// å·²åˆ é™¤å¾…åŠ

// ===== 3. åœºæ™¯3ï¼šä½¿ç”¨ closest å¤„ç†åµŒå¥—å…ƒç´  =====
console.log("\n=== åœºæ™¯3ï¼šåµŒå¥—å…ƒç´ ç‚¹å‡» ===");

<div id="card-list">
  <div class="card" data-id="1">
    <h3>å¡ç‰‡æ ‡é¢˜1</h3>
    <p>å¡ç‰‡å†…å®¹</p>
    <button class="like-btn">
      <span class="icon">ğŸ‘</span>
      <span class="text">ç‚¹èµ</span>
    </button>
  </div>
  <div class="card" data-id="2">
    <h3>å¡ç‰‡æ ‡é¢˜2</h3>
    <p>å¡ç‰‡å†…å®¹</p>
    <button class="like-btn">
      <span class="icon">ğŸ‘</span>
      <span class="text">ç‚¹èµ</span>
    </button>
  </div>
</div>

const cardList = document.querySelector('#card-list');

cardList.addEventListener('click', (event) => {
  // å‘ä¸ŠæŸ¥æ‰¾ .like-btnï¼ˆå³ä½¿ç‚¹å‡»çš„æ˜¯å†…éƒ¨çš„ spanï¼‰
  const likeBtn = event.target.closest('.like-btn');

  if (likeBtn) {
    const card = likeBtn.closest('.card');
    const cardId = card.dataset.id;
    console.log(`ç‚¹èµäº†å¡ç‰‡ ${cardId}`);
    likeBtn.classList.toggle('liked');
  }
});

// ç‚¹å‡»"ç‚¹èµ"æŒ‰é’®ï¼ˆæˆ–å…¶å†…éƒ¨çš„ icon/textï¼‰ï¼Œéƒ½ä¼šè§¦å‘
// è¾“å‡ºï¼šç‚¹èµäº†å¡ç‰‡ 1

// ===== 4. åœºæ™¯4ï¼šé˜»æ­¢äº‹ä»¶å†’æ³¡ =====
console.log("\n=== åœºæ™¯4ï¼šé˜»æ­¢å†’æ³¡ ===");

<div id="outer">
  <div id="middle">
    <button id="inner">ç‚¹å‡»æˆ‘</button>
  </div>
</div>

document.querySelector('#outer').addEventListener('click', () => {
  console.log('outer ç‚¹å‡»');
});

document.querySelector('#middle').addEventListener('click', () => {
  console.log('middle ç‚¹å‡»');
});

document.querySelector('#inner').addEventListener('click', (event) => {
  console.log('inner ç‚¹å‡»');
  event.stopPropagation(); // é˜»æ­¢å†’æ³¡
});

// ç‚¹å‡»æŒ‰é’®ï¼Œåªè¾“å‡ºï¼š
// inner ç‚¹å‡»

// ===== 5. åœºæ™¯5ï¼šäº‹ä»¶å§”æ‰˜æ€§èƒ½å¯¹æ¯” =====
console.log("\n=== åœºæ™¯5ï¼šæ€§èƒ½å¯¹æ¯” ===");

// æ–¹å¼1ï¼šä¸ç”¨äº‹ä»¶å§”æ‰˜ï¼ˆä¸ºæ¯ä¸ªå…ƒç´ ç»‘å®šï¼‰
function withoutDelegation() {
  const container = document.querySelector('#container1');
  container.innerHTML = '';

  const start = performance.now();

  for (let i = 0; i < 1000; i++) {
    const button = document.createElement('button');
    button.textContent = `æŒ‰é’® ${i}`;

    // æ¯ä¸ªæŒ‰é’®éƒ½ç»‘å®šäº‹ä»¶
    button.addEventListener('click', () => {
      console.log(`ç‚¹å‡»äº†æŒ‰é’® ${i}`);
    });

    container.appendChild(button);
  }

  const elapsed = performance.now() - start;
  console.log(`ä¸ç”¨å§”æ‰˜ï¼šåˆ›å»º 1000 ä¸ªæŒ‰é’®è€—æ—¶ ${elapsed.toFixed(2)}ms`);
}

// æ–¹å¼2ï¼šç”¨äº‹ä»¶å§”æ‰˜ï¼ˆåªåœ¨çˆ¶å…ƒç´ ç»‘å®šä¸€æ¬¡ï¼‰
function withDelegation() {
  const container = document.querySelector('#container2');
  container.innerHTML = '';

  const start = performance.now();

  // åªç»‘å®šä¸€æ¬¡äº‹ä»¶
  container.addEventListener('click', (event) => {
    if (event.target.tagName === 'BUTTON') {
      const index = event.target.dataset.index;
      console.log(`ç‚¹å‡»äº†æŒ‰é’® ${index}`);
    }
  });

  for (let i = 0; i < 1000; i++) {
    const button = document.createElement('button');
    button.textContent = `æŒ‰é’® ${i}`;
    button.dataset.index = i;

    container.appendChild(button);
  }

  const elapsed = performance.now() - start;
  console.log(`ç”¨å§”æ‰˜ï¼šåˆ›å»º 1000 ä¸ªæŒ‰é’®è€—æ—¶ ${elapsed.toFixed(2)}ms`);
}

withoutDelegation();
withDelegation();

// è¾“å‡ºï¼š
// ä¸ç”¨å§”æ‰˜ï¼šåˆ›å»º 1000 ä¸ªæŒ‰é’®è€—æ—¶ 45.23ms
// ç”¨å§”æ‰˜ï¼šåˆ›å»º 1000 ä¸ªæŒ‰é’®è€—æ—¶ 12.56ms

// ===== 6. åœºæ™¯6ï¼šæ¨¡æ‹Ÿ React åˆæˆäº‹ä»¶ =====
console.log("\n=== åœºæ™¯6ï¼šæ¨¡æ‹Ÿ React åˆæˆäº‹ä»¶ ===");

class SimpleSyntheticEvent {
  constructor() {
    this.listeners = new Map(); // å­˜å‚¨äº‹ä»¶ç›‘å¬å™¨
    this.rootElement = null;
  }

  // åˆå§‹åŒ–æ ¹å…ƒç´ 
  init(rootElement) {
    this.rootElement = rootElement;

    // åœ¨æ ¹å…ƒç´ ä¸Šç›‘å¬åŸç”Ÿäº‹ä»¶
    this.rootElement.addEventListener('click', (nativeEvent) => {
      this.dispatchEvent(nativeEvent);
    });

    console.log('åˆæˆäº‹ä»¶ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
  }

  // æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨
  addEventListener(element, eventType, handler) {
    if (!this.listeners.has(element)) {
      this.listeners.set(element, new Map());
    }

    const elementListeners = this.listeners.get(element);
    if (!elementListeners.has(eventType)) {
      elementListeners.set(eventType, []);
    }

    elementListeners.get(eventType).push(handler);
    console.log(`ä¸ºå…ƒç´ æ·»åŠ  ${eventType} ç›‘å¬å™¨`);
  }

  // åˆ†å‘äº‹ä»¶
  dispatchEvent(nativeEvent) {
    const targetElement = nativeEvent.target;

    // åˆ›å»ºåˆæˆäº‹ä»¶å¯¹è±¡
    const syntheticEvent = {
      type: nativeEvent.type,
      target: targetElement,
      currentTarget: this.rootElement,
      nativeEvent: nativeEvent,
      preventDefault: () => nativeEvent.preventDefault(),
      stopPropagation: () => nativeEvent.stopPropagation(),
    };

    // æŸ¥æ‰¾å¹¶æ‰§è¡Œç›‘å¬å™¨
    const listeners = this.listeners.get(targetElement);

    if (listeners && listeners.has('click')) {
      const handlers = listeners.get('click');
      handlers.forEach(handler => handler(syntheticEvent));
    }
  }
}

// ä½¿ç”¨
const syntheticEventSystem = new SimpleSyntheticEvent();
const root = document.querySelector('#root');

syntheticEventSystem.init(root);

// æ³¨å†Œäº‹ä»¶
const button1 = document.querySelector('#button1');
syntheticEventSystem.addEventListener(button1, 'click', (event) => {
  console.log('æŒ‰é’®1è¢«ç‚¹å‡»');
  console.log('åˆæˆäº‹ä»¶:', event);
  console.log('åŸç”Ÿäº‹ä»¶:', event.nativeEvent);
});

// ç‚¹å‡»æŒ‰é’®1ï¼Œè¾“å‡ºï¼š
// æŒ‰é’®1è¢«ç‚¹å‡»
// åˆæˆäº‹ä»¶: { type: 'click', target: button#button1, ... }
// åŸç”Ÿäº‹ä»¶: MouseEvent { ... }
```

**è¿è¡Œè¾“å‡ºç¤ºä¾‹ï¼š**

```
=== åœºæ™¯1ï¼šåˆ—è¡¨é¡¹ç‚¹å‡» ===
ç‚¹å‡»äº†é¡¹ç›® 2

=== åœºæ™¯2ï¼šåŠ¨æ€æ·»åŠ å…ƒç´  ===
æ·»åŠ äº†å¾…åŠ 1
æ·»åŠ äº†å¾…åŠ 2
æ·»åŠ äº†å¾…åŠ 3
å·²åˆ é™¤å¾…åŠ

=== åœºæ™¯3ï¼šåµŒå¥—å…ƒç´ ç‚¹å‡» ===
ç‚¹èµäº†å¡ç‰‡ 1

=== åœºæ™¯4ï¼šé˜»æ­¢å†’æ³¡ ===
inner ç‚¹å‡»

=== åœºæ™¯5ï¼šæ€§èƒ½å¯¹æ¯” ===
ä¸ç”¨å§”æ‰˜ï¼šåˆ›å»º 1000 ä¸ªæŒ‰é’®è€—æ—¶ 45.23ms
ç”¨å§”æ‰˜ï¼šåˆ›å»º 1000 ä¸ªæŒ‰é’®è€—æ—¶ 12.56ms

=== åœºæ™¯6ï¼šæ¨¡æ‹Ÿ React åˆæˆäº‹ä»¶ ===
åˆæˆäº‹ä»¶ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ
ä¸ºå…ƒç´ æ·»åŠ  click ç›‘å¬å™¨
æŒ‰é’®1è¢«ç‚¹å‡»
åˆæˆäº‹ä»¶: { type: 'click', target: button#button1, ... }
åŸç”Ÿäº‹ä»¶: MouseEvent { ... }
```

---

### è¿›é˜¶ï¼šReact åˆæˆäº‹ä»¶ç³»ç»Ÿ

```javascript
// React åˆæˆäº‹ä»¶ç³»ç»Ÿçš„æ ¸å¿ƒæ€æƒ³ï¼ˆç®€åŒ–ç‰ˆï¼‰

class ReactEventSystem {
  constructor() {
    // å­˜å‚¨ DOM èŠ‚ç‚¹åˆ° Fiber èŠ‚ç‚¹çš„æ˜ å°„
    this.domToFiberMap = new WeakMap();

    // å­˜å‚¨äº‹ä»¶ç›‘å¬å™¨
    this.rootEventHandlers = new Map();
  }

  // åœ¨æ ¹å®¹å™¨ä¸Šæ³¨å†Œäº‹ä»¶
  registerEvents(rootContainer) {
    // æ•è·é˜¶æ®µ
    rootContainer.addEventListener('click', (e) => {
      this.dispatchEvent(e, 'onClickCapture');
    }, true);

    // å†’æ³¡é˜¶æ®µ
    rootContainer.addEventListener('click', (e) => {
      this.dispatchEvent(e, 'onClick');
    }, false);

    console.log('React äº‹ä»¶ç³»ç»Ÿå·²æ³¨å†Œåˆ°æ ¹å®¹å™¨');
  }

  // å°† DOM èŠ‚ç‚¹å…³è”åˆ° Fiber èŠ‚ç‚¹
  attachFiberToDOM(domNode, fiber) {
    this.domToFiberMap.set(domNode, fiber);
  }

  // åˆ†å‘äº‹ä»¶
  dispatchEvent(nativeEvent, reactEventName) {
    const targetDOM = nativeEvent.target;

    // æ‰¾åˆ°å¯¹åº”çš„ Fiber èŠ‚ç‚¹
    const fiber = this.domToFiberMap.get(targetDOM);

    if (!fiber) {
      return;
    }

    // åˆ›å»ºåˆæˆäº‹ä»¶
    const syntheticEvent = this.createSyntheticEvent(nativeEvent);

    // æ”¶é›†äº‹ä»¶è·¯å¾„ï¼ˆä»ç›®æ ‡å…ƒç´ åˆ°æ ¹å…ƒç´ ï¼‰
    const eventPath = this.collectEventPath(fiber);

    // æ‰§è¡Œäº‹ä»¶å¤„ç†å‡½æ•°
    if (reactEventName === 'onClick') {
      // å†’æ³¡é˜¶æ®µï¼šä»ç›®æ ‡åˆ°æ ¹
      eventPath.forEach(fiber => {
        const handler = fiber.props[reactEventName];
        if (handler) {
          handler(syntheticEvent);
        }
      });
    } else if (reactEventName === 'onClickCapture') {
      // æ•è·é˜¶æ®µï¼šä»æ ¹åˆ°ç›®æ ‡
      eventPath.reverse().forEach(fiber => {
        const handler = fiber.props[reactEventName];
        if (handler) {
          handler(syntheticEvent);
        }
      });
    }
  }

  // åˆ›å»ºåˆæˆäº‹ä»¶å¯¹è±¡
  createSyntheticEvent(nativeEvent) {
    return {
      type: nativeEvent.type,
      target: nativeEvent.target,
      currentTarget: nativeEvent.currentTarget,
      nativeEvent: nativeEvent,

      preventDefault() {
        nativeEvent.preventDefault();
      },

      stopPropagation() {
        nativeEvent.stopPropagation();
        this._isPropagationStopped = true;
      },

      isPropagationStopped() {
        return this._isPropagationStopped || false;
      },
    };
  }

  // æ”¶é›†äº‹ä»¶è·¯å¾„
  collectEventPath(fiber) {
    const path = [];
    let current = fiber;

    while (current) {
      path.push(current);
      current = current.return; // çˆ¶ Fiber èŠ‚ç‚¹
    }

    return path;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const eventSystem = new ReactEventSystem();
const root = document.querySelector('#root');

eventSystem.registerEvents(root);

// æ¨¡æ‹Ÿ React ç»„ä»¶æ ‘
const parentFiber = {
  props: {
    onClick: (e) => console.log('çˆ¶å…ƒç´ ç‚¹å‡»'),
  },
  return: null,
};

const childFiber = {
  props: {
    onClick: (e) => {
      console.log('å­å…ƒç´ ç‚¹å‡»');
      e.stopPropagation();
    },
  },
  return: parentFiber,
};

// å…³è” DOM å’Œ Fiber
const childDOM = document.querySelector('#child');
eventSystem.attachFiberToDOM(childDOM, childFiber);

// ç‚¹å‡»å­å…ƒç´ ï¼Œè¾“å‡ºï¼š
// å­å…ƒç´ ç‚¹å‡»
// ï¼ˆstopPropagation é˜»æ­¢äº†çˆ¶å…ƒç´ çš„å¤„ç†å‡½æ•°ï¼‰
```

**React 17+ çš„å…³é”®æ”¹è¿›**ï¼š

1. **äº‹ä»¶å§”æ‰˜ä½ç½®**ï¼šä» `document` æ”¹ä¸ºæ ¹å®¹å™¨
2. **ç§»é™¤äº‹ä»¶æ± **ï¼šäº‹ä»¶å¯¹è±¡ä¸å†è¢«å›æ”¶
3. **æ›´å¥½çš„æµè§ˆå™¨å…¼å®¹æ€§**ï¼šç»Ÿä¸€çš„äº‹ä»¶å¤„ç†

---

## å…«ã€ã€é¢è¯•å¿…é—®ã€‘

### é—®é¢˜ï¼š"React çš„äº‹ä»¶ç³»ç»Ÿå’ŒåŸç”Ÿäº‹ä»¶æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆ React 17 æ”¹å˜äº†äº‹ä»¶å§”æ‰˜ä½ç½®ï¼Ÿ"

**æ™®é€šå›ç­”ï¼ˆâŒ ä¸å‡ºå½©ï¼‰ï¼š**

"React äº‹ä»¶æ˜¯åˆæˆäº‹ä»¶ï¼Œæ€§èƒ½æ›´å¥½ã€‚React 17 æŠŠäº‹ä»¶ä» document ç§»åˆ°äº†æ ¹å…ƒç´ ã€‚"

**å‡ºå½©å›ç­”ï¼ˆâœ… æ¨èï¼‰ï¼š**

> **React äº‹ä»¶ç³»ç»Ÿå’ŒåŸç”Ÿäº‹ä»¶çš„æ ¸å¿ƒåŒºåˆ«ï¼š**
>
> 1. **äº‹ä»¶å¯¹è±¡**ï¼š
>    - **åŸç”Ÿäº‹ä»¶**ï¼šæµè§ˆå™¨çš„åŸç”Ÿäº‹ä»¶å¯¹è±¡ï¼ˆMouseEventã€KeyboardEvent ç­‰ï¼‰
>    - **React åˆæˆäº‹ä»¶**ï¼šSyntheticEventï¼Œå°è£…äº†åŸç”Ÿäº‹ä»¶ï¼Œæä¾›è·¨æµè§ˆå™¨ä¸€è‡´çš„ API
>
> 2. **äº‹ä»¶ç»‘å®š**ï¼š
>    - **åŸç”Ÿäº‹ä»¶**ï¼šç›´æ¥åœ¨ DOM å…ƒç´ ä¸Šç»‘å®šï¼ˆ`element.addEventListener`ï¼‰
>    - **React äº‹ä»¶**ï¼šé€šè¿‡äº‹ä»¶å§”æ‰˜ï¼Œç»Ÿä¸€åœ¨æ ¹å®¹å™¨ä¸Šç›‘å¬
>
> 3. **å†…å­˜å ç”¨**ï¼š
>    - **åŸç”Ÿäº‹ä»¶**ï¼šæ¯ä¸ªå…ƒç´ ç‹¬ç«‹ç»‘å®šï¼Œå†…å­˜å ç”¨é«˜
>    - **React äº‹ä»¶**ï¼šäº‹ä»¶å§”æ‰˜ï¼Œåªåœ¨æ ¹å®¹å™¨ç»‘å®šï¼Œå†…å­˜å ç”¨ä½
>
> 4. **äº‹ä»¶å†’æ³¡**ï¼š
>    - **åŸç”Ÿäº‹ä»¶**ï¼š`stopPropagation` é˜»æ­¢åŸç”Ÿäº‹ä»¶å†’æ³¡
>    - **React åˆæˆäº‹ä»¶**ï¼š`stopPropagation` åªé˜»æ­¢ React åˆæˆäº‹ä»¶å†’æ³¡ï¼Œä¸å½±å“åŸç”Ÿäº‹ä»¶
>
> **React 17 ä¸ºä»€ä¹ˆæ”¹å˜äº‹ä»¶å§”æ‰˜ä½ç½®ï¼Ÿ**
>
> React 16 åŠä¹‹å‰ï¼Œæ‰€æœ‰äº‹ä»¶éƒ½å§”æ‰˜åˆ° `document`ï¼Œè¿™åœ¨ä»¥ä¸‹åœºæ™¯ä¼šæœ‰é—®é¢˜ï¼š
>
> 1. **å¤šä¸ª React åº”ç”¨å…±å­˜**ï¼š
>    ```javascript
>    <div id="app1"></div>
>    <div id="app2"></div>
>
>    // ä¸¤ä¸ªåº”ç”¨çš„äº‹ä»¶éƒ½å§”æ‰˜åˆ° documentï¼Œä¼šäº’ç›¸å¹²æ‰°
>    ```
>
> 2. **å¾®å‰ç«¯æ¶æ„**ï¼šå­åº”ç”¨çš„äº‹ä»¶ä¼šä¼ æ’­åˆ°ä¸»åº”ç”¨
>
> 3. **`event.stopPropagation()` ä¸ç”Ÿæ•ˆ**ï¼š
>    ```javascript
>    // React 16ï¼šstopPropagation æ— æ³•é˜»æ­¢ä¼ æ’­åˆ°å…¶ä»– React åº”ç”¨
>    // React 17+ï¼šæ¯ä¸ªåº”ç”¨ç‹¬ç«‹ï¼ŒstopPropagation çœŸæ­£ç”Ÿæ•ˆ
>    ```
>
> React 17 æ”¹ä¸ºå§”æ‰˜åˆ°æ ¹å®¹å™¨ï¼ˆ`ReactDOM.createRoot(container)` çš„ `container`ï¼‰ï¼Œè§£å†³äº†è¿™äº›é—®é¢˜ï¼š
> - æ¯ä¸ª React åº”ç”¨æœ‰ç‹¬ç«‹çš„äº‹ä»¶ç³»ç»Ÿ
> - äº‹ä»¶éš”ç¦»æ›´å¥½
> - æ”¯æŒæ¸è¿›å¼å‡çº§ï¼ˆåŒä¸€é¡µé¢è¿è¡Œä¸åŒç‰ˆæœ¬çš„ Reactï¼‰
>
> **åœ¨å®é™…å·¥ä½œä¸­çš„åº”ç”¨**ï¼š
>
> - **å¾®å‰ç«¯é¡¹ç›®**ï¼šä¸»åº”ç”¨å’Œå­åº”ç”¨çš„äº‹ä»¶ä¸ä¼šäº’ç›¸å¹²æ‰°
> - **æ··åˆåŸç”Ÿå’Œ React**ï¼šå¯ä»¥æ›´å¥½åœ°æ§åˆ¶äº‹ä»¶ä¼ æ’­
> - **æ€§èƒ½ä¼˜åŒ–**ï¼šå¤§å‹åº”ç”¨ä¸­ï¼Œäº‹ä»¶å§”æ‰˜æ˜¾è‘—é™ä½å†…å­˜å ç”¨
>
> **ä¸€ä¸ªå®¹æ˜“è¢«å¿½ç•¥çš„ç»†èŠ‚**ï¼š
>
> React å¹¶éæ‰€æœ‰äº‹ä»¶éƒ½ç”¨å§”æ‰˜ï¼Œ`scroll`ã€`focus`ã€`blur` ç­‰ä¸å†’æ³¡çš„äº‹ä»¶ï¼ŒReact ä»ç„¶ç›´æ¥ç»‘å®šåˆ°å…ƒç´ ä¸Šã€‚

**ä¸ºä»€ä¹ˆè¿™ä¸ªå›ç­”å‡ºå½©ï¼Ÿ**

1. âœ… ä»å¤šä¸ªç»´åº¦å¯¹æ¯”ï¼ˆäº‹ä»¶å¯¹è±¡ã€ç»‘å®šæ–¹å¼ã€å†…å­˜ã€å†’æ³¡ï¼‰
2. âœ… è§£é‡Šäº† React 17 çš„æ”¹è¿›åŸå› å’Œè§£å†³çš„é—®é¢˜
3. âœ… ç»“åˆå®é™…åº”ç”¨åœºæ™¯ï¼ˆå¾®å‰ç«¯ã€æ··åˆå¼€å‘ï¼‰
4. âœ… æåˆ°äº†å®¹æ˜“è¢«å¿½ç•¥çš„ç»†èŠ‚ï¼ˆä¸å†’æ³¡äº‹ä»¶çš„å¤„ç†ï¼‰

---

## ä¹ã€ã€åŒ–éª¨ç»µæŒã€‘

### å¡ç‰‡1ï¼šç›´è§‰ç†è§£ ğŸ¯

**ä¸€å¥è¯ï¼š** äº‹ä»¶å§”æ‰˜æ˜¯åœ¨çˆ¶å…ƒç´ ä¸Šç›‘å¬å­å…ƒç´ çš„äº‹ä»¶ã€‚

**ä¸¾ä¾‹ï¼š**

```javascript
parent.addEventListener('click', (e) => {
  if (e.target.tagName === 'BUTTON') {
    console.log('æŒ‰é’®è¢«ç‚¹å‡»');
  }
});
```

**åº”ç”¨ï¼š** å‡å°‘äº‹ä»¶ç›‘å¬å™¨æ•°é‡ï¼Œæå‡æ€§èƒ½ã€‚

---

### å¡ç‰‡2ï¼šäº‹ä»¶å†’æ³¡ ğŸ“ˆ

**ä¸€å¥è¯ï¼š** äº‹ä»¶ä»ç›®æ ‡å…ƒç´ å‘ä¸Šå†’æ³¡åˆ° documentã€‚

**å†’æ³¡è·¯å¾„ï¼š**

```
button â†’ div â†’ body â†’ html â†’ document
```

**åº”ç”¨ï¼š** äº‹ä»¶å§”æ‰˜çš„åŸºç¡€æœºåˆ¶ã€‚

---

### å¡ç‰‡3ï¼ševent.target vs event.currentTarget ğŸ¯

**ä¸€å¥è¯ï¼š** target æ˜¯è§¦å‘äº‹ä»¶çš„å…ƒç´ ï¼ŒcurrentTarget æ˜¯ç»‘å®šç›‘å¬å™¨çš„å…ƒç´ ã€‚

**ä¸¾ä¾‹ï¼š**

```javascript
parent.addEventListener('click', (e) => {
  console.log(e.target); // è¢«ç‚¹å‡»çš„å­å…ƒç´ 
  console.log(e.currentTarget); // parent
});
```

**åº”ç”¨ï¼š** äº‹ä»¶å§”æ‰˜ä¸­åˆ¤æ–­å®é™…è§¦å‘çš„å…ƒç´ ã€‚

---

### å¡ç‰‡4ï¼šstopPropagation ğŸ›‘

**ä¸€å¥è¯ï¼š** é˜»æ­¢äº‹ä»¶ç»§ç»­å†’æ³¡ã€‚

**ä¸¾ä¾‹ï¼š**

```javascript
button.addEventListener('click', (e) => {
  e.stopPropagation(); // é˜»æ­¢å†’æ³¡åˆ°çˆ¶å…ƒç´ 
});
```

**åº”ç”¨ï¼š** æ§åˆ¶äº‹ä»¶ä¼ æ’­èŒƒå›´ã€‚

---

### å¡ç‰‡5ï¼šclosest æ–¹æ³• ğŸ”

**ä¸€å¥è¯ï¼š** å‘ä¸ŠæŸ¥æ‰¾æœ€è¿‘çš„åŒ¹é…å…ƒç´ ã€‚

**ä¸¾ä¾‹ï¼š**

```javascript
const item = e.target.closest('.list-item');
if (item) {
  console.log('ç‚¹å‡»äº†åˆ—è¡¨é¡¹');
}
```

**åº”ç”¨ï¼š** å¤„ç†åµŒå¥—å…ƒç´ çš„äº‹ä»¶å§”æ‰˜ã€‚

---

### å¡ç‰‡6ï¼šåŠ¨æ€å…ƒç´ è‡ªåŠ¨ç”Ÿæ•ˆ ğŸ”„

**ä¸€å¥è¯ï¼š** äº‹ä»¶å§”æ‰˜è‡ªåŠ¨æ”¯æŒæ–°æ·»åŠ çš„å…ƒç´ ã€‚

**ä¸¾ä¾‹ï¼š**

```javascript
list.addEventListener('click', handler);

// ä¹‹åæ·»åŠ çš„å…ƒç´ ä¹Ÿä¼šè§¦å‘ handler
list.appendChild(newElement);
```

**åº”ç”¨ï¼š** æ— éœ€ä¸ºåŠ¨æ€å…ƒç´ é‡æ–°ç»‘å®šäº‹ä»¶ã€‚

---

### å¡ç‰‡7ï¼šReact åˆæˆäº‹ä»¶ âš›ï¸

**ä¸€å¥è¯ï¼š** React äº‹ä»¶æ˜¯åˆæˆäº‹ä»¶ï¼Œå§”æ‰˜åˆ°æ ¹å®¹å™¨ã€‚

**å¯¹æ¯”ï¼š**

| ç‰¹æ€§ | åŸç”Ÿäº‹ä»¶ | React åˆæˆäº‹ä»¶ |
|-----|---------|---------------|
| ç»‘å®šä½ç½® | æ¯ä¸ªå…ƒç´  | æ ¹å®¹å™¨ |
| è·¨æµè§ˆå™¨ | éœ€å…¼å®¹ | ç»Ÿä¸€ API |

**åº”ç”¨ï¼š** React äº‹ä»¶ç³»ç»Ÿçš„æ ¸å¿ƒæœºåˆ¶ã€‚

---

### å¡ç‰‡8ï¼šReact 17 çš„æ”¹è¿› ğŸ†•

**ä¸€å¥è¯ï¼š** React 17 å°†äº‹ä»¶å§”æ‰˜ä» document æ”¹ä¸ºæ ¹å®¹å™¨ã€‚

**åŸå› ï¼š**
- æ”¯æŒå¤šä¸ª React åº”ç”¨å…±å­˜
- æ›´å¥½çš„äº‹ä»¶éš”ç¦»
- æ”¯æŒå¾®å‰ç«¯

**åº”ç”¨ï¼š** å¾®å‰ç«¯å’Œå¤šåº”ç”¨åœºæ™¯ã€‚

---

### å¡ç‰‡9ï¼šæ€§èƒ½ä¼˜åŠ¿ âš¡

**ä¸€å¥è¯ï¼š** äº‹ä»¶å§”æ‰˜å¤§å¹…å‡å°‘å†…å­˜å ç”¨ã€‚

**å¯¹æ¯”ï¼š**

```
1000 ä¸ªå…ƒç´ ï¼š
- ä¸ç”¨å§”æ‰˜ï¼š1000 ä¸ªç›‘å¬å™¨
- ç”¨å§”æ‰˜ï¼š1 ä¸ªç›‘å¬å™¨
```

**åº”ç”¨ï¼š** å¤§å‹åˆ—è¡¨ã€åŠ¨æ€å†…å®¹çš„æ€§èƒ½ä¼˜åŒ–ã€‚

---

### å¡ç‰‡10ï¼šæ€»ç»“ä¸å»¶ä¼¸ ğŸ“

**æ€»ç»“ï¼š**

äº‹ä»¶å§”æ‰˜æ˜¯åˆ©ç”¨äº‹ä»¶å†’æ³¡æœºåˆ¶åœ¨çˆ¶å…ƒç´ ç»Ÿä¸€ç›‘å¬çš„æŠ€æœ¯ï¼Œé€šè¿‡å‡å°‘ç›‘å¬å™¨æ•°é‡ã€æ”¯æŒåŠ¨æ€å…ƒç´ ï¼Œæ˜¾è‘—æå‡æ€§èƒ½ï¼Œæ˜¯ React åˆæˆäº‹ä»¶ç³»ç»Ÿçš„æ ¸å¿ƒåŸºç¡€ã€‚

**æ ¸å¿ƒä¼˜åŠ¿ï¼š**
1. å‡å°‘å†…å­˜å ç”¨
2. è‡ªåŠ¨æ”¯æŒåŠ¨æ€å…ƒç´ 
3. ç»Ÿä¸€äº‹ä»¶ç®¡ç†
4. æå‡æ€§èƒ½

**å»¶ä¼¸å­¦ä¹ ï¼š**
- React åˆæˆäº‹ä»¶ç³»ç»Ÿæºç 
- æµè§ˆå™¨äº‹ä»¶æœºåˆ¶ï¼ˆæ•è·ã€ç›®æ ‡ã€å†’æ³¡ï¼‰
- äº‹ä»¶ä¼˜å…ˆçº§ç®¡ç†
- å¾®å‰ç«¯äº‹ä»¶éš”ç¦»

---

## åã€ã€ä¸€å¥è¯æ€»ç»“ã€‘

**äº‹ä»¶å§”æ‰˜æ˜¯åˆ©ç”¨äº‹ä»¶å†’æ³¡æœºåˆ¶åœ¨çˆ¶å…ƒç´ ç»Ÿä¸€ç›‘å¬å­å…ƒç´ äº‹ä»¶çš„æŠ€æœ¯ï¼Œé€šè¿‡ event.target åˆ¤æ–­å®é™…è§¦å‘å…ƒç´ ï¼Œå¤§å¹…å‡å°‘ç›‘å¬å™¨æ•°é‡å’Œå†…å­˜å ç”¨ï¼Œè‡ªåŠ¨æ”¯æŒåŠ¨æ€å…ƒç´ ï¼Œæ˜¯ React åˆæˆäº‹ä»¶ç³»ç»Ÿçš„æ ¸å¿ƒåŸºç¡€ï¼ŒReact 17+ å°†å§”æ‰˜ä½ç½®ä» document æ”¹ä¸ºæ ¹å®¹å™¨ä»¥æ”¯æŒå¤šåº”ç”¨å…±å­˜å’Œæ›´å¥½çš„äº‹ä»¶éš”ç¦»ã€‚**

---

## é™„å½•

### å­¦ä¹ æ£€æŸ¥æ¸…å•

- [ ] ç†è§£äº‹ä»¶å†’æ³¡æœºåˆ¶
- [ ] æŒæ¡äº‹ä»¶å§”æ‰˜çš„åŸºæœ¬ç”¨æ³•
- [ ] ç†è§£ event.target å’Œ event.currentTarget çš„åŒºåˆ«
- [ ] æŒæ¡ stopPropagation çš„ä½¿ç”¨
- [ ] ç†è§£äº‹ä»¶å§”æ‰˜çš„æ€§èƒ½ä¼˜åŠ¿
- [ ] ç†è§£ React åˆæˆäº‹ä»¶ç³»ç»Ÿçš„åŸç†
- [ ] äº†è§£ React 17 çš„äº‹ä»¶å§”æ‰˜æ”¹è¿›
- [ ] èƒ½å¤Ÿå¤„ç†åŠ¨æ€å…ƒç´ çš„äº‹ä»¶
- [ ] æŒæ¡ closest æ–¹æ³•çš„ä½¿ç”¨

### ä¸‹ä¸€æ­¥å­¦ä¹ å»ºè®®

1. **æ·±å…¥ React äº‹ä»¶ç³»ç»Ÿ**ï¼šé˜…è¯» React äº‹ä»¶ç³»ç»Ÿæºç ï¼Œç†è§£å®Œæ•´å®ç°
2. **å­¦ä¹ äº‹ä»¶ä¼˜å…ˆçº§**ï¼šäº†è§£ React å¦‚ä½•ä¸ºä¸åŒäº‹ä»¶è®¾ç½®ä¼˜å…ˆçº§
3. **ç ”ç©¶æµè§ˆå™¨äº‹ä»¶æœºåˆ¶**ï¼šæ·±å…¥ç†è§£æ•è·ã€ç›®æ ‡ã€å†’æ³¡ä¸‰ä¸ªé˜¶æ®µ
4. **å®è·µå¾®å‰ç«¯**ï¼šåœ¨å¾®å‰ç«¯é¡¹ç›®ä¸­åº”ç”¨äº‹ä»¶éš”ç¦»

### å‚è€ƒèµ„æº

- [MDN - Event bubbling and capture](https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Building_blocks/Events#event_bubbling_and_capture)
- [React - Events](https://react.dev/learn/responding-to-events)
- [React 17 - Event Delegation](https://reactjs.org/blog/2020/08/10/react-v17-rc.html#changes-to-event-delegation)
- [æ·±å…¥ç†è§£ React åˆæˆäº‹ä»¶](https://github.com/facebook/react/tree/main/packages/react-dom/src/events)
